<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>BUDDHA – Aviation Crash Analytics Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- ====== LIBRARIES ====== -->
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- ====== GLOBAL STYLES ====== -->
  <style>
    * {
      box-sizing: border-box;
      scroll-behavior: smooth;
    }

    body {
      margin: 0;
      font-family: "Segoe UI", Arial, sans-serif;
      background: linear-gradient(135deg, #f8f9fe, #e8f4fd);
      color: #2c3e50;
    }

    /* ===== NAVBAR ===== */
    nav {
      position: sticky;
      top: 0;
      z-index: 1000;
      background: #2e86ab;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 14px 28px;
    }

    nav .logo {
      font-size: 20px;
      font-weight: bold;
      color: #ffffff;
    }

    nav ul {
      list-style: none;
      display: flex;
      gap: 18px;
      margin: 0;
      padding: 0;
    }

    nav ul li a {
      color: #ffffff;
      text-decoration: none;
      font-weight: 600;
      font-size: 14px;
    }

    nav ul li a:hover {
      text-decoration: underline;
    }

    /* ===== SECTION ===== */
    section {
      padding: 60px 40px;
    }

    .section-title {
      font-size: 32px;
      font-weight: 800;
      color: #2e86ab;
      margin-bottom: 30px;
      text-align: center;
    }

    /* ===== METRICS ===== */
    .metrics {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 24px;
      margin-bottom: 40px;
    }

    .metric-card {
      background: #ffffff;
      border-radius: 20px;
      padding: 24px;
      text-align: center;
      box-shadow: 0 8px 32px rgba(46, 134, 171, 0.15);
      border: 2px solid #e3f2fd;
    }

    .metric-number {
      font-size: 36px;
      font-weight: 800;
      color: #2e86ab;
    }

    .metric-label {
      margin-top: 6px;
      font-size: 15px;
      color: #546e7a;
    }

    /* ===== CHART / MAP CONTAINERS ===== */
    .card {
      background: #ffffff;
      border-radius: 18px;
      padding: 20px;
      margin-bottom: 40px;
      box-shadow: 0 6px 24px rgba(0, 0, 0, 0.08);
    }

    #map {
      height: 500px;
      border-radius: 14px;
    }

    /* ===== FOOTER ===== */
    footer {
      background: #1f3b4d;
      color: #ffffff;
      padding: 40px 30px;
    }

    footer .footer-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 30px;
    }

    footer h4 {
      margin-bottom: 10px;
    }

    footer p,
    footer a {
      font-size: 14px;
      color: #dceef7;
      text-decoration: none;
    }

    footer a:hover {
      text-decoration: underline;
    }

    .copyright {
      margin-top: 30px;
      text-align: center;
      font-size: 13px;
      opacity: 0.8;
    }
  </style>
</head>

<body>

<!-- ===== NAVBAR ===== -->
<nav>
  <div class="logo">✈️ BUDDHA Dashboard</div>
  <ul>
    <li><a href="#dashboard">Dashboard</a></li>
    <li><a href="#globe">Globe</a></li>
    <li><a href="#analytics">Analytics</a></li>
    <li><a href="#timeline">Timeline</a></li>
    <li><a href="#map-section">Map</a></li>
    <li><a href="#export">Export</a></li>
    <li><a href="#about">About</a></li>
  </ul>
</nav>

<!-- ===== DASHBOARD ===== -->
<section id="dashboard">
  <div class="section-title">Aviation Crash Overview</div>

  <div class="metrics">
    <div class="metric-card">
      <div class="metric-number" id="totalCrashes">0</div>
      <div class="metric-label">Total Crashes</div>
    </div>
    <div class="metric-card">
      <div class="metric-number" id="totalFatalities">0</div>
      <div class="metric-label">Total Fatalities</div>
    </div>
    <div class="metric-card">
      <div class="metric-number" id="avgFatalities">0</div>
      <div class="metric-label">Avg Fatalities / Crash</div>
    </div>
  </div>
</section>

<!-- ===== GLOBE ===== -->
<section id="globe">
  <div class="section-title">3D Crash Globe</div>
  <div class="card">
    <div id="globeChart" style="height:650px;"></div>
  </div>
</section>

<!-- ===== ANALYTICS ===== -->
<section id="analytics">
  <div class="section-title">Analytics</div>
  <div class="card">
    <canvas id="decadeChart" height="140"></canvas>
  </div>
</section>

<!-- ===== TIMELINE ===== -->
<section id="timeline">
  <div class="section-title">Crash Timeline</div>
  <div class="card">
    <canvas id="timelineChart" height="140"></canvas>
  </div>
</section>

<!-- ===== MAP ===== -->
<section id="map-section">
  <div class="section-title">Crash Locations Map</div>
  <div class="card">
    <div id="map"></div>
  </div>
</section>

<!-- ===== EXPORT ===== -->
<section id="export">
  <div class="section-title">Export</div>
  <div class="card">
    <button onclick="exportJSON()">Export JSON</button>
    <button onclick="exportCSV()">Export CSV</button>
  </div>
</section>

<!-- ===== ABOUT ===== -->
<section id="about">
  <div class="section-title">About Project</div>
  <div class="card">
    <p>
      BUDDHA – Aviation Crash Analytics Dashboard is a data-driven visualization
      platform to analyze global aviation accidents using interactive charts,
      maps, and timelines.
    </p>
  </div>
</section>

<!-- ===== FOOTER ===== -->
<footer>
  <div class="footer-grid">
    <div>
      <h4>BUDDHA Project</h4>
      <p>Aviation Crash Analytics Dashboard</p>
    </div>
    <div>
      <h4>Tech Stack</h4>
      <p>Python · FastAPI · Plotly · Chart.js · Leaflet · JavaScript</p>
    </div>
    <div>
      <h4>Links</h4>
      <a href="#">GitHub</a><br />
      <a href="#">Documentation</a>
    </div>
  </div>

  <div class="copyright">
    © 2026 BUDDHA Project. All rights reserved.
  </div>
</footer>

<!-- ===== JAVASCRIPT ===== -->
<script>
  const API_BASE = "http://127.0.0.1:8000";

  let crashData = [];

  async function loadStats() {
    const res = await fetch(API_BASE + "/stats");
    const data = await res.json();

    document.getElementById("totalCrashes").innerText = data.total_crashes;
    document.getElementById("totalFatalities").innerText = data.total_fatalities;
    document.getElementById("avgFatalities").innerText =
      data.avg_fatalities.toFixed(1);
  }

  async function loadData() {
    const res = await fetch(API_BASE + "/data");
    crashData = await res.json();

    renderGlobe(crashData);
    renderCharts(crashData);
    renderMap(crashData);
  }

  function renderGlobe(data) {
    const fig = {
      data: [
        {
          type: "scattergeo",
          lon: data.map(d => d.longitude),
          lat: data.map(d => d.latitude),
          text: data.map(d => d.Location),
          mode: "markers",
          marker: {
            size: data.map(d => Math.log1p(d.Fatalities) * 2 + 5),
            color: data.map(d => d.Fatalities),
            colorscale: "Reds",
            opacity: 0.8
          }
        }
      ],
      layout: {
        geo: { projection: { type: "orthographic" } },
        margin: { t: 0, b: 0 }
      }
    };

    Plotly.newPlot("globeChart", fig);
  }

  function renderCharts(data) {
    const byDecade = {};
    data.forEach(d => {
      const dec = Math.floor(d.year / 10) * 10;
      byDecade[dec] = (byDecade[dec] || 0) + 1;
    });

    new Chart(document.getElementById("decadeChart"), {
      type: "bar",
      data: {
        labels: Object.keys(byDecade),
        datasets: [{
          label: "Crashes per Decade",
          data: Object.values(byDecade),
          backgroundColor: "#2e86ab"
        }]
      }
    });
  }

  function renderMap(data) {
    const map = L.map("map").setView([20, 0], 2);
    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png").addTo(map);

    data.forEach(d => {
      if (d.latitude && d.longitude) {
        L.circleMarker([d.latitude, d.longitude], {
          radius: 6,
          color: "red"
        }).addTo(map).bindPopup(d.Location);
      }
    });
  }

  function exportJSON() {
    const blob = new Blob([JSON.stringify(crashData, null, 2)], {
      type: "application/json"
    });
    download(blob, "crashes.json");
  }

  function exportCSV() {
    let csv = "Location,Year,Fatalities\n";
    crashData.forEach(d => {
      csv += `${d.Location},${d.year},${d.Fatalities}\n`;
    });
    download(new Blob([csv], { type: "text/csv" }), "crashes.csv");
  }

  function download(blob, filename) {
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = filename;
    a.click();
  }

  loadStats();
  loadData();
</script>

</body>
</html>
